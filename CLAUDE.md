# PkmnFusion - Project Instructions

A Pokémon-style fusion game built with Bevy and Rust.

## Project Overview

Gen 2 Pokémon-inspired game with:
- Pixel art aesthetic (16x16 tiles)
- Grid-based movement
- Multiple biomes (grass, water, etc.)
- Tile ID system for extensibility

## Git workflow
- Before starting work, check for uncommitted changes - refuse to work until resolved (commit or revert)
- Before starting work, branch off from current working branch prefixed with "claude-" (e.g., base `feature/ABC-123` → `claude-feature/ABC-123`)
- Refuse to branch from `main` or `develop` directly - ask user to create a ticket first.
- Commit when a change is commit-worthy and represents a clear progression step
- Commit messages: short, concise, sacrifice grammar for concision. Never mention model names, "claude", "generated by", or add co-author lines.
- When work complete, open PR on GitHub from work branch into base branch.
- After PR merged, delete "claude-" prefixed branch locally and on remote if safe.
- PR format:
  ```
  ## Summary
  - bullet points describing changes

  ## Usage
  code examples if applicable

  ## Test plan
  - [ ] checklist of verification steps
  ```

## Code Structure

```
src/
├── main.rs           # App setup, entry point
├── components.rs     # Shared ECS components
├── tiles/            # Tile system
│   ├── mod.rs       # Registry + TileDefinition
│   ├── grass.rs     # Grass tiles (IDs 100-199)
│   └── water.rs     # Water tiles (IDs 200-299)
├── map.rs           # Map spawning, tile placement
└── player.rs        # Player movement, camera, collision
```

## Tile ID System

**Stable IDs** - Never change, used in maps:
```rust
pub const GRASS_PLAIN_1: TileDefinition = TileDefinition::new(
    101,                           // Stable ID
    "grass_plain_1",               // Name
    "grass_biome_8x_16x16.png",    // Atlas file
    0,                             // Atlas index (can change)
    true,                          // Walkable
);
```

**Benefits:**
- Add tiles without breaking maps
- Reorganize atlases freely
- Descriptive tile names

## Asset Naming Convention

```
<biome>_biome_<columns>x<tile_size>.png

Examples:
- grass_biome_8x_16x16.png   (8 tiles, 16x16 each)
- water_biome_1x_16x16.png   (1 tile, 16x16)
```

Atlases can be 1D (1x8) or 2D (4x8) grids. Index is linear.

## Adding New Tiles

1. Add to atlas PNG
2. Define in `tiles/grass.rs` (or new biome file):
```rust
pub const NEW_TILE: TileDefinition = TileDefinition::new(
    109,                      // Next available ID
    "descriptive_name",
    "grass_biome_8x_16x16.png",
    8,                        // Index in atlas
    true,                     // Walkable
);
```
3. Add to `GRASS_TILES` array
4. Use in maps: `map_data.set_tile(x, y, NEW_TILE.id)`

## Map Layout

- Size: 16x16 tiles (configurable in `map.rs`)
- Coordinate system: (0,0) = bottom-left
- Multiple tilemap layers auto-generated per atlas

## Controls

- WASD: Move player
- Z/X: Zoom in/out

## Development Workflow

**Hot reloading with cargo-watch:**
```bash
# Install once
cargo install cargo-watch

# Run with auto-recompile on file save
cargo watch -x 'run --release'

# Or with dynamic linking (faster recompiles)
cargo watch -x 'run --features dev'
```

**Performance:**
- Debug mode (`cargo run`) is slow but usable (opt-level 1)
- Release mode (`cargo run --release`) for testing performance
- Dynamic linking (`--features dev`) saves 2-3s per recompile

## Coding Style

- Concise, no unnecessary abstractions
- Use Bevy ECS patterns (components, systems, resources)
- Pixel-perfect rendering (nearest-neighbor filtering)
- Grid-aligned positions (16px steps)
- Commit messages: short, concise, sacrifice grammar for concision. Never mention model names, "claude", "generated by", or add co-author lines

## Future Ideas

Track in GitHub issues with `enhancement` or `idea` labels:
- Animation system
- Tile transitions (borders)
- Wild encounters
- Battle system
- NPC dialogues
- Weather effects
